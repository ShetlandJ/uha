<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Songs</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 0 15px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    header h1 {
      margin: 0;
    }
    .track {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .track h3 {
      margin: 0 0 10px 0;
      font-size: 1.25rem;
    }
    audio {
      display: none;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #ddd;
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
    }
    .progress-fill {
      height: 100%;
      background: #27ae60;
      width: 0%;
      transition: width 0.1s linear;
    }
    .controls {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .play-btn {
      background: #27ae60;
      font-size: 1.5rem;
      padding: 12px 24px;
    }
    button {
      padding: 10px 16px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      color: white;
      font-size: 1rem;
    }
    .fade-btn {
      background: #e67e22;
    }
    .reset-btn {
      background: #3498db;
    }
    .reset-all-btn {
      background: #e74c3c;
    }
  </style>
</head>
<body>
  <header>
    <h1>Songs</h1>
    <button class="reset-all-btn" onclick="resetAll()">Reset All</button>
  </header>

  <div class="track">
    <h3>Life is a Highway (Boosted)</h3>
    <div class="progress-bar"><div class="progress-fill"></div></div>
    <audio src="songs/1 life is a highway boosted.mp3"></audio>
    <div class="controls">
      <button class="play-btn" onclick="togglePlay(this)">Play</button>
      <button class="fade-btn" onclick="fadeToNext(this)">Fade to Next</button>
      <button class="reset-btn" onclick="reset(this)">Reset</button>
    </div>
  </div>

  <div class="track">
    <h3>Heigh-Ho</h3>
    <div class="progress-bar"><div class="progress-fill"></div></div>
    <audio src="songs/2 Heigh-Ho.mp3"></audio>
    <div class="controls">
      <button class="play-btn" onclick="togglePlay(this)">Play</button>
      <button class="fade-btn" onclick="fadeToNext(this)">Fade to Next</button>
      <button class="reset-btn" onclick="reset(this)">Reset</button>
    </div>
  </div>

  <div class="track">
    <h3>AC/DC - Highway to Hell</h3>
    <div class="progress-bar"><div class="progress-fill"></div></div>
    <audio src="songs/3 AC_DC - Highway to Hell Audio.mp3"></audio>
    <div class="controls">
      <button class="play-btn" onclick="togglePlay(this)">Play</button>
      <button class="fade-btn" onclick="fadeToNext(this)">Fade to Next</button>
      <button class="reset-btn" onclick="reset(this)">Reset</button>
    </div>
  </div>

  <div class="track">
    <h3>Phone - Gibberish - Bonnie</h3>
    <div class="progress-bar"><div class="progress-fill"></div></div>
    <audio src="songs/4 Phone - Gibberish - Bonnie.mp3"></audio>
    <div class="controls">
      <button class="play-btn" onclick="togglePlay(this)">Play</button>
      <button class="fade-btn" onclick="fadeToNext(this)">Fade to Next</button>
      <button class="reset-btn" onclick="reset(this)">Reset</button>
    </div>
  </div>

  <div class="track">
    <h3>Willie Nelson - On The Road Again</h3>
    <div class="progress-bar"><div class="progress-fill"></div></div>
    <audio src="songs/5 Willie Nelson - On The Road Again Official Audio.mp3"></audio>
    <div class="controls">
      <button class="play-btn" onclick="togglePlay(this)">Play</button>
      <button class="fade-btn" onclick="fadeToNext(this)">Fade to Next</button>
      <button class="reset-btn" onclick="reset(this)">Reset</button>
    </div>
  </div>

  <div class="track">
    <h3>Danger: High Voltage (2025 Remaster)</h3>
    <div class="progress-bar"><div class="progress-fill"></div></div>
    <audio src="songs/6 Danger_ High Voltage 2025 Remaster.mp3"></audio>
    <div class="controls">
      <button class="play-btn" onclick="togglePlay(this)">Play</button>
      <button class="fade-btn" onclick="fadeToNext(this)">Fade to Next</button>
      <button class="reset-btn" onclick="reset(this)">Reset</button>
    </div>
  </div>

  <script>
    let audioContext = null;
    const gainNodes = new Map();

    function getGainNode(audio) {
      if (!gainNodes.has(audio)) {
        if (!audioContext) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        const source = audioContext.createMediaElementSource(audio);
        const gainNode = audioContext.createGain();
        source.connect(gainNode);
        gainNode.connect(audioContext.destination);
        gainNodes.set(audio, gainNode);
      }
      return gainNodes.get(audio);
    }

    function ensureAudioContext() {
      if (audioContext && audioContext.state === 'suspended') {
        audioContext.resume();
      }
    }

    function togglePlay(btn) {
      const track = btn.closest('.track');
      const audio = track.querySelector('audio');
      const gainNode = getGainNode(audio);
      ensureAudioContext();
      gainNode.gain.value = 1;
      if (audio.paused) {
        audio.play();
        btn.textContent = 'Pause';
      } else {
        audio.pause();
        btn.textContent = 'Play';
      }
    }

    function fadeToNext(btn) {
      const track = btn.closest('.track');
      const audio = track.querySelector('audio');
      const playBtn = track.querySelector('.play-btn');
      const progressFill = track.querySelector('.progress-fill');
      const gainNode = getGainNode(audio);

      const nextTrack = track.nextElementSibling;
      let nextStarted = false;
      let nextAudio, nextGainNode, nextPlayBtn;

      if (nextTrack && nextTrack.classList.contains('track')) {
        nextAudio = nextTrack.querySelector('audio');
        nextGainNode = getGainNode(nextAudio);
        nextPlayBtn = nextTrack.querySelector('.play-btn');
        nextGainNode.gain.value = 0;
      }

      let vol = gainNode.gain.value;
      let nextVol = 0;

      btn.textContent = 'Fading...';
      const fade = setInterval(() => {
        if (vol > 0.05) {
          vol -= 0.05;
          gainNode.gain.value = vol;

          // Start next track when current is at 20% volume
          if (nextAudio && !nextStarted && vol <= 0.2) {
            nextStarted = true;
            ensureAudioContext();
            nextAudio.play();
            nextPlayBtn.textContent = 'Pause';
          }

          // Fade in next track
          if (nextStarted && nextVol < 1) {
            nextVol += 0.1;
            nextGainNode.gain.value = Math.min(nextVol, 1);
          }
        } else {
          clearInterval(fade);
          gainNode.gain.value = 0;
          audio.pause();
          audio.currentTime = 0;
          progressFill.style.width = '0%';
          playBtn.textContent = 'Play';

          // Ensure next track is at full volume
          if (nextGainNode) {
            nextGainNode.gain.value = 1;
          }
          btn.textContent = btn.dataset.lastTrack ? 'Fade Out' : 'Fade to Next';
        }
      }, 100);
    }

    function reset(btn) {
      const track = btn.closest('.track');
      const audio = track.querySelector('audio');
      const playBtn = track.querySelector('.play-btn');
      const progressFill = track.querySelector('.progress-fill');
      const gainNode = gainNodes.get(audio);
      audio.pause();
      if (gainNode) gainNode.gain.value = 1;
      audio.currentTime = 0;
      progressFill.style.width = '0%';
      playBtn.textContent = 'Play';
    }

    function resetAll() {
      document.querySelectorAll('.track').forEach(track => {
        const audio = track.querySelector('audio');
        const playBtn = track.querySelector('.play-btn');
        const progressFill = track.querySelector('.progress-fill');
        const gainNode = gainNodes.get(audio);
        audio.pause();
        if (gainNode) gainNode.gain.value = 1;
        audio.currentTime = 0;
        progressFill.style.width = '0%';
        playBtn.textContent = 'Play';
      });
    }

    // Set up progress bars and audio event listeners
    document.querySelectorAll('.track').forEach(track => {
      const audio = track.querySelector('audio');
      const progressBar = track.querySelector('.progress-bar');
      const progressFill = track.querySelector('.progress-fill');
      const playBtn = track.querySelector('.play-btn');

      audio.addEventListener('timeupdate', () => {
        if (audio.duration) {
          progressFill.style.width = (audio.currentTime / audio.duration * 100) + '%';
        }
      });

      audio.addEventListener('ended', () => {
        playBtn.textContent = 'Play';
        progressFill.style.width = '0%';
        audio.currentTime = 0;
      });

      progressBar.addEventListener('click', (e) => {
        if (audio.duration) {
          const rect = progressBar.getBoundingClientRect();
          const pos = (e.clientX - rect.left) / rect.width;
          audio.currentTime = pos * audio.duration;
        }
      });
    });

    // Handle visibility change to resume audio context
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        ensureAudioContext();
      }
    });

    // Set last track's fade button to "Fade Out"
    const tracks = document.querySelectorAll('.track');
    const lastFadeBtn = tracks[tracks.length - 1].querySelector('.fade-btn');
    lastFadeBtn.textContent = 'Fade Out';
    lastFadeBtn.dataset.lastTrack = 'true';
  </script>
</body>
</html>
